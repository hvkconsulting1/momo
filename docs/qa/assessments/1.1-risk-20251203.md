# Risk Profile: Story 1.1 - Initialize Project Structure and Development Environment

**Date:** 2025-12-03
**Reviewer:** Quinn (Test Architect)
**Story:** 1.1 - Initialize Project Structure and Development Environment
**Status:** Draft

---

## Executive Summary

- **Total Risks Identified:** 7
- **Critical Risks (Score 9):** 0
- **High Risks (Score 6):** 2
- **Medium Risks (Score 4):** 2
- **Low Risks (Score 2-3):** 3
- **Overall Risk Score:** 64/100 (Moderate risk)

**Assessment:** Story 1.1 has moderate risk primarily due to Windows-WSL bridge complexity and potential for accidentally committing large data files. All identified risks have clear mitigation strategies and are manageable within the story scope.

**Key Risks Requiring Attention:**
1. **TECH-002** (High): Windows-WSL bridge complexity - Mitigate with isolated module and comprehensive tests
2. **OPS-001** (High): Git data directory exclusion - Mitigate with `.gitignore`, pre-commit hooks, and CI checks

---

## Critical Risks Requiring Immediate Attention

**None identified.** No critical (score 9) risks exist for this infrastructure setup story.

---

## High-Priority Risks (Score 6)

### 1. TECH-002: Windows-WSL Bridge Complexity

**Score: 6 (High)**
**Probability:** High (3) - Bridge pattern is required per Story 1.0 findings
**Impact:** Medium (2) - Could complicate development/testing but proven pattern exists

**Description:**
Story 1.0 (Norgate API Exploration Spike) determined that WSL development environment requires Windows Python (`python.exe`) to access Norgate Data Updater via subprocess bridge. This introduces architectural complexity and potential failure modes.

**Affected Components:**
- `src/momo/data/bridge.py` (to be created)
- Norgate integration modules
- Test fixtures requiring market data
- CI/CD environment (if running in WSL)

**Mitigation Strategy:** Preventive + Detective

**Actions:**
1. Create isolated bridge module (`src/momo/data/bridge.py`) with clear, documented interface
2. Implement comprehensive error handling for subprocess failures with diagnostic messages
3. Add unit tests with mocked subprocess calls to verify error handling paths
4. Include integration test (1.1-INT-001 or similar) validating actual Windows Python bridge
5. Document Windows Python path requirements prominently in `README.md` setup section
6. Add fixture in `tests/conftest.py` for automatic Windows Python path detection

**Testing Focus:**
- **Unit Tests:** Mock subprocess module, test all error paths (Windows Python not found, subprocess timeout, invalid output)
- **Integration Tests:** Execute actual bridge call to Windows Python, verify data round-trip
- **Fixtures:** Create reusable test fixture that conditionally skips tests if Windows Python unavailable

**Residual Risk:** Low - Bridge pattern was validated in Story 1.0 spike with successful Russell 3000 data fetch

**Owner:** Dev
**Timeline:** During Story 1.1 implementation (bridge creation not required until later stories, but foundation should be planned)

---

### 2. OPS-001: Git Data Directory Exclusion

**Score: 6 (High)**
**Probability:** Medium (2) - Common mistake in data-heavy projects
**Impact:** High (3) - Could bloat repo, expose proprietary data, break git operations

**Description:**
The `data/` directory will contain cached market data (Parquet files) that must NEVER be committed to git. Story requirements include Russell 3000 C&P dataset (12,225 symbols) which could grow to gigabytes. Accidentally committing this data would:
- Bloat repository size unacceptably
- Slow all git operations (clone, fetch, push)
- Potentially expose proprietary Norgate data
- Require git history rewrite to fix

**Affected Components:**
- `.gitignore` file
- `data/` directory and all subdirectories
- Git repository integrity
- CI/CD pipeline (large checkouts would slow builds)

**Mitigation Strategy:** Preventive + Detective

**Actions:**
1. Create comprehensive `.gitignore` with `data/` as first exclusion line
2. Add git pre-commit hook to explicitly reject any files matching `data/**/*`
3. Include automated unit test (1.1-UNIT-001 or dedicated test) verifying `.gitignore` exists and contains `data/` pattern
4. Add CI check: `git ls-files | grep '^data/' && exit 1 || exit 0` to fail build if data/ files present
5. Document data directory exclusion in README with prominent warning
6. Add comment in `.gitignore` explaining why `data/` is excluded

**Testing Focus:**
- **Unit Test:** Read `.gitignore`, assert it contains line matching `^data/` or `/data/`
- **Integration Test:** Create dummy file `data/test.parquet`, run `git add data/test.parquet`, verify rejection (requires pre-commit hook setup)
- **CI Pipeline:** Add check step to verify `data/` directory not in git tree

**Residual Risk:** Low - Multiple layers of protection (gitignore, pre-commit hook, CI check)

**Owner:** Dev + CI/CD
**Timeline:** Before first git commit in Story 1.1

---

## Medium-Priority Risks (Score 4)

### 3. TECH-001: Python 3.13 Compatibility

**Score: 4 (Medium)**
**Probability:** Medium (2) - Python 3.13 released October 2024, still very new
**Impact:** Medium (2) - Could require fallback to 3.12 or dependency version adjustments

**Description:**
Tech stack mandates Python 3.13, which is the latest stable release but only ~2 months old. Some core dependencies (numpy, scipy, pandas) are compiled extensions that may not have pre-built wheels for 3.13 on all platforms, especially Linux/WSL. This could cause:
- `uv sync` failures requiring source compilation
- Extended build times for compiled dependencies
- Potential incompatibilities requiring version downgrades
- Need to fall back to Python 3.12

**Affected Components:**
- All Python packages, especially: numpy (2.1.x), scipy (1.14.x), pandas (2.2.x), pyarrow (18.x)
- `pyproject.toml` dependency specifications
- `.python-version` file
- CI/CD environment setup

**Mitigation Strategy:** Detective + Corrective

**Actions:**
1. Run `uv sync` immediately after environment setup to detect compatibility issues early
2. Monitor uv output for source builds (indicates no wheel available)
3. If issues arise, document workarounds in `README.md` (e.g., specific package versions)
4. Add integration test (1.1-INT-001) verifying `uv sync` succeeds with exit code 0
5. Verify all critical imports succeed: `import pandas, numpy, scipy, matplotlib`
6. **Fallback Plan:** If blocking issues found, change `.python-version` to `3.12` and document decision

**Testing Focus:**
- **Integration Test:** Execute `uv sync` as subprocess, assert exit code 0 and no error output
- **Import Test:** Verify `import momo` and all core dependencies can be imported
- **Version Verification:** Check installed package versions match `pyproject.toml` specifications

**Residual Risk:** Low - Python 3.12 is mature fallback; numpy/scipy/pandas typically support latest Python quickly

**Owner:** Dev
**Timeline:** Story 1.1 environment setup phase (first task block)

---

### 4. DATA-001: WSL-Windows Path Accessibility

**Score: 4 (Medium)**
**Probability:** Medium (2) - Cross-platform file path handling is notoriously tricky
**Impact:** Medium (2) - Would break data caching workflow between WSL and Windows Python

**Description:**
Data caching workflow requires files written by WSL Python to be readable by Windows Python (via bridge). Path `/home/frank/momo/data/` must be accessible from both environments. Potential issues:
- Windows path translation (`\\wsl$\Ubuntu\home\frank\momo\data\` or similar)
- File permissions differences between WSL and Windows
- Symlink handling discrepancies
- Path separator inconsistencies (`/` vs `\`)

**Affected Components:**
- `data/cache/` subdirectories (prices, constituents, universes)
- `src/momo/data/bridge.py` path resolution
- File I/O operations in data layer
- Test fixtures using cached data

**Mitigation Strategy:** Preventive + Detective

**Actions:**
1. Use absolute paths consistently: `/home/frank/momo/data/` (not relative paths)
2. Test path accessibility bidirectionally (WSL→Windows and Windows→WSL)
3. Add integration test: WSL Python writes dummy Parquet, Windows Python bridge reads it back
4. Document path requirements in `docs/architecture/tech-stack.md` and README
5. Include path validation in bridge module initialization (fail fast if paths inaccessible)
6. Use `pathlib.Path` for cross-platform path manipulation in code

**Testing Focus:**
- **Integration Test:** Write file from WSL Python (`data/test.parquet`), read via Windows bridge, verify content matches
- **Path Resolution Test:** Verify `Path('/home/frank/momo/data')` resolves correctly from both environments
- **Subdirectory Test:** Test accessibility of nested paths (`data/cache/prices/`, etc.)

**Residual Risk:** Low - Story 1.0 spike validated this approach; Frank's environment already working

**Owner:** Dev
**Timeline:** Story 1.1 or when bridge implementation begins (possibly later story)

---

## Low-Priority Risks (Score 2-3)

### 5. OPS-002: Story-Based Test Organization

**Score: 3 (Low)**
**Probability:** Low (1) - Clear documentation exists in architecture docs
**Impact:** High (3) - Incorrect structure would break AI agent workflow assumptions

**Description:**
Story uses non-standard test organization (`tests/stories/{story}/`) optimized for AI agents rather than traditional pytest structure (`tests/unit/`, `tests/integration/`). Risk of deviation from documented structure, causing:
- Pytest test discovery failures
- AI agent tooling unable to map tests to stories
- Inconsistent test naming breaking automated workflows

**Mitigation:** Follow `docs/architecture/test-strategy-and-standards.md:1-630` exactly

**Actions:**
1. Create structure: `tests/stories/1.1/unit/`, `tests/stories/1.1/integration/`
2. Use strict naming: `1.1-UNIT-001.py`, `1.1-INT-001.py`
3. Add `conftest.py` at `tests/` and `tests/stories/1.1/` levels
4. Include README in `tests/stories/1.1/` explaining structure
5. Add unit test (1.1-UNIT-003) verifying directory structure exists

**Residual Risk:** Minimal
**Owner:** Dev
**Timeline:** Story 1.1 test creation phase

---

### 6. TECH-003: uv Dependency Manager Maturity

**Score: 2 (Low)**
**Probability:** Low (1) - uv 0.5+ is stable and actively maintained by Astral
**Impact:** Medium (2) - Could affect CI/CD, team onboarding, IDE support

**Description:**
uv is relatively new compared to pip/poetry. Potential issues:
- IDE integration less mature (VS Code, PyCharm plugins)
- CI/CD examples less common (GitHub Actions setup)
- Team familiarity lower (steeper learning curve)
- Lockfile format changes in future versions

**Mitigation:**
- Document uv version requirement (0.5+) in README
- Commit `uv.lock` for reproducible builds
- Test uv workflow in CI early
- Include troubleshooting section in README

**Residual Risk:** Minimal
**Owner:** Dev
**Timeline:** Story 1.1 environment setup

---

### 7. SEC-001: Environment Variable Security

**Score: 2 (Low)**
**Probability:** Low (1) - Standard practice, `.env` in `.gitignore`
**Impact:** Medium (2) - Could expose API keys if misconfigured

**Description:**
Risk of committing `.env` files with credentials (future Norgate API keys, database passwords). Story requirements include `.gitignore` with `.env` exclusion.

**Mitigation:**
- Include `.env*` patterns in `.gitignore`
- Add comment explaining credential exclusion
- Unit test verifies `.gitignore` includes `.env` pattern
- Code review checks for hardcoded credentials

**Residual Risk:** Minimal
**Owner:** Dev
**Timeline:** Story 1.1 `.gitignore` creation

---

## Risk Distribution

### By Category

| Category      | Total Risks | Critical | High | Medium | Low |
|---------------|-------------|----------|------|--------|-----|
| Technical     | 3           | 0        | 1    | 2      | 0   |
| Operational   | 2           | 0        | 1    | 0      | 1   |
| Data          | 1           | 0        | 0    | 1      | 0   |
| Security      | 1           | 0        | 0    | 0      | 1   |
| Performance   | 0           | 0        | 0    | 0      | 0   |
| Business      | 0           | 0        | 0    | 0      | 0   |

### By Component

| Component                  | Risk Count | Highest Score |
|----------------------------|------------|---------------|
| Git/Version Control        | 1          | 6 (OPS-001)   |
| Python Environment         | 2          | 4 (TECH-001)  |
| Windows-WSL Bridge         | 2          | 6 (TECH-002)  |
| Test Infrastructure        | 1          | 3 (OPS-002)   |
| Security/Credentials       | 1          | 2 (SEC-001)   |

---

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests (Score 6)

**TECH-002: Windows-WSL Bridge**
- **Unit Tests:**
  - Mock subprocess calls to Windows Python
  - Test error handling: Windows Python not found, invalid path, subprocess timeout
  - Verify error messages are diagnostic and actionable
- **Integration Tests:**
  - Execute actual bridge call to Windows Python (detect via path, e.g., `/mnt/c/Python313/python.exe`)
  - Test data round-trip: Pass JSON to Windows Python, receive parsed response
  - Verify bridge works from pytest (same environment as dev)

**OPS-001: Git Data Exclusion**
- **Unit Tests:**
  - Read `.gitignore`, assert contains `data/` or `/data/` line
  - Verify `.gitignore` exists in project root
- **Integration Tests:**
  - Create `data/test-file.txt`, run `git status`, assert file not listed as untracked
  - (Requires pre-commit hook) Attempt `git add data/test-file.txt`, verify rejection
- **CI Tests:**
  - Pipeline step: `git ls-files | grep '^data/' && exit 1 || exit 0`
  - Fail build if any files under `data/` committed

### Priority 2: Medium Risk Tests (Score 4)

**TECH-001: Python 3.13 Compatibility**
- **Integration Tests:**
  - Execute `uv sync` as subprocess, capture stdout/stderr
  - Assert exit code 0, no error messages
  - Verify `uv.lock` created
  - Test core imports: `python -c "import pandas, numpy, scipy, matplotlib, seaborn, norgatedata"`

**DATA-001: WSL-Windows Path Accessibility**
- **Integration Tests:**
  - WSL Python: Write dummy Parquet to `data/cache/test.parquet`
  - Windows Python bridge: Read same file, verify content
  - Test nested paths: `data/cache/prices/`, `data/cache/constituents/`
  - Verify `pathlib.Path('/home/frank/momo/data')` resolves correctly

### Priority 3: Low Risk Tests (Score 2-3)

**OPS-002: Story-Based Test Organization**
- **Unit Tests (1.1-UNIT-003):**
  - Verify `tests/stories/1.1/unit/` exists
  - Verify `tests/stories/1.1/integration/` exists
  - Verify `tests/conftest.py` exists
  - Verify `tests/stories/1.1/conftest.py` exists

**TECH-003: uv Dependency Manager**
- **Integration Tests:**
  - Execute `uv --version`, assert exit code 0
  - Verify `uv.lock` committed to git
  - Test `uv sync` in fresh clone (CI simulation)

**SEC-001: Environment Variable Security**
- **Unit Tests:**
  - Read `.gitignore`, assert contains `.env` pattern (e.g., `*.env`, `.env*`)
  - Code review checklist: No hardcoded credentials in source

---

## Risk-Based Test Coverage Goals

Based on risk profile, the following test coverage targets are appropriate:

| Layer/Component       | Target Coverage | Rationale                                    |
|-----------------------|-----------------|----------------------------------------------|
| Data Bridge Module    | 95%+            | High risk (TECH-002), critical path          |
| Git Configuration     | 100%            | High risk (OPS-001), simple to verify        |
| Environment Setup     | 90%+            | Medium risk (TECH-001, DATA-001)             |
| Test Infrastructure   | 80%+            | Low risk but foundational                    |
| Overall Story 1.1     | 85%+            | Infrastructure story, high testability       |

---

## Risk Acceptance Criteria

### Must Fix Before Story Completion

1. **OPS-001** - `.gitignore` must exclude `data/` with verification test
2. **TECH-002** - Bridge architecture must be documented (implementation may be later story)

### Can Mark Story Complete With Mitigation Plan

1. **TECH-001** - If Python 3.13 issues arise, document and use Python 3.12
2. **DATA-001** - Document path requirements; full validation may occur in later story

### Accepted Risks (No Additional Action)

1. **OPS-002** - Clear documentation exists; follow it
2. **TECH-003** - uv is stable; document usage
3. **SEC-001** - Standard practice; covered by `.gitignore`

---

## Monitoring Requirements

### Post-Story Monitoring

1. **Git Repository Size**
   - Alert if repo size exceeds 100MB (indicates possible data/ commit)
   - Weekly check: `du -sh .git` should remain under 50MB

2. **Dependency Compatibility**
   - Monitor uv sync success rate across team/CI
   - Track Python version in use (3.13 vs 3.12 fallback)

3. **Test Execution Success**
   - Track pytest discovery success (should find all `1.1-*` tests)
   - Monitor test execution time (infrastructure tests should be fast)

4. **Bridge Reliability** (when implemented)
   - Track subprocess failures in logs
   - Monitor Windows Python path resolution success

---

## Integration with Quality Gates

**Gate Determination Logic:**

Based on risk profile:
- **No Critical Risks (Score 9):** Gate is not FAIL by default
- **2 High Risks (Score 6):** Gate should be **CONCERNS** unless mitigations verified
- **Recommendations:** Must-fix items required for PASS gate

**Preliminary Gate Assessment:** **CONCERNS**

**Rationale:**
- Two high-priority risks require verification before PASS
- OPS-001 (git exclusion) must be verified before first commit
- TECH-002 (bridge) should be architecturally planned even if implementation is later story

**Path to PASS Gate:**
1. Verify `.gitignore` includes `data/` with unit test
2. Document bridge architecture requirements in README or architecture docs
3. Verify Python environment setup succeeds (uv sync passes)
4. All Story 1.1 tests pass (including 1.1-UNIT-001, 1.1-UNIT-002, 1.1-UNIT-003, 1.1-INT-001, 1.1-INT-002)

---

## Risk Review Triggers

Re-assess this risk profile if any of the following occur:

1. **Architecture Changes:**
   - Shift away from Windows-WSL bridge approach
   - Change from uv to different dependency manager
   - Modify directory structure significantly

2. **Technology Changes:**
   - Upgrade/downgrade Python version
   - Change core dependencies (pandas, numpy versions)
   - Add new data sources beyond Norgate

3. **Environment Changes:**
   - Team expands (onboarding friction with uv)
   - CI/CD platform changes
   - Development environment shifts (WSL to native Linux)

4. **Discovered Issues:**
   - Python 3.13 compatibility problems emerge
   - Git repository accidentally includes data/ files
   - Bridge pattern fails in unexpected ways

5. **Downstream Story Risks:**
   - Story 1.2+ introduces new risks affecting infrastructure
   - Test complexity grows beyond initial estimates

---

## Appendix: Risk Scoring Reference

**Risk Score Calculation:**
- Base Score: 100
- Critical (9): -20 points each
- High (6): -10 points each
- Medium (4): -5 points each
- Low (2-3): -2 points each

**Story 1.1 Calculation:**
- Base: 100
- High (6): 2 × -10 = -20
- Medium (4): 2 × -5 = -10
- Low (2-3): 3 × -2 = -6
- **Final Score: 64/100** (Moderate Risk)

**Risk Level Interpretation:**
- 90-100: Minimal Risk (Routine changes)
- 70-89: Low Risk (Standard development)
- 50-69: Moderate Risk (Requires attention) ← **Story 1.1 is here**
- 30-49: High Risk (Significant concerns)
- 0-29: Critical Risk (Major issues)

---

## Summary and Recommendations

Story 1.1 presents **moderate risk (64/100)** primarily due to infrastructure complexity (Windows-WSL bridge) and operational concerns (data directory exclusion). All risks are manageable with clear mitigation strategies documented above.

**Key Actions for Dev:**
1. **High Priority:** Create comprehensive `.gitignore` with `data/` exclusion + verification test (OPS-001)
2. **High Priority:** Document bridge architecture requirements even if implementation is later story (TECH-002)
3. **Medium Priority:** Test Python 3.13 compatibility early; be ready to fall back to 3.12 (TECH-001)
4. **Medium Priority:** Validate WSL-Windows path accessibility in integration tests (DATA-001)

**Quality Gate Path:**
- Current Assessment: **CONCERNS** (due to 2 high-priority risks)
- To achieve **PASS**: Verify mitigations for OPS-001 and TECH-002, pass all Story 1.1 tests
- **FAIL** not warranted: No critical risks, all issues have clear mitigations

**Testing Focus:**
- Emphasize integration tests for environment setup and git configuration
- Create reusable fixtures for Windows Python bridge testing
- Verify story-based test organization structure

**Next Steps:**
1. Review this risk profile with team
2. Incorporate mitigation actions into Story 1.1 task execution
3. Create quality gate file with risk summary YAML block
4. Execute Story 1.1 with risk-aware testing strategy
5. Update gate decision after story completion and test results

---

**Risk Profile Reference for Gate File:**

```yaml
risk_summary:
  totals:
    critical: 0
    high: 2
    medium: 2
    low: 3
  highest:
    id: TECH-002
    score: 6
    title: 'Windows-WSL bridge complexity'
  recommendations:
    must_fix:
      - 'Implement comprehensive .gitignore with data/ exclusion and automated verification (OPS-001)'
      - 'Create isolated bridge module with error handling and integration tests (TECH-002)'
    monitor:
      - 'Verify Python 3.13 dependency compatibility during uv sync; fall back to 3.12 if issues (TECH-001)'
      - 'Test WSL-Windows path accessibility in integration tests (DATA-001)'
```

---

**Document Control:**
- **Created:** 2025-12-03
- **Author:** Quinn (Test Architect)
- **Version:** 1.0
- **Related Documents:**
  - Story File: `docs/stories/1.1.story.md`
  - Test Strategy: `docs/architecture/test-strategy-and-standards.md`
  - Tech Stack: `docs/architecture/tech-stack.md`
  - Source Tree: `docs/architecture/source-tree.md`
