# Story 1.1: Initialize Project Structure and Development Environment

## Status

**In Progress**

## Story

**As a** developer,
**I want** the project structure and dependencies set up following the specified monorepo layout,
**so that** I can begin development with proper tooling and organization in place.

## Acceptance Criteria

1. Repository follows the specified structure with directories: `data/`, `src/` (with subdirs: `data/`, `signals/`, `portfolio/`, `backtest/`, `risk/`, `utils/`), `notebooks/`, `docs/`, `tests/`, and `results/`
2. Python 3.10+ environment is configured with uv (Astral) for dependency management
3. `.gitignore` is configured to exclude `data/` directory and common Python artifacts (__pycache__, .pyc, .env, etc.)
4. Initial `pyproject.toml` or `requirements.txt` includes core dependencies: pandas, numpy, scipy, matplotlib, seaborn, jupyter, pytest
5. `README.md` provides basic project overview and setup instructions
6. `docs/research-log.md` template is created with structure for documenting experiments (date, hypothesis, parameters, results, insights)
7. Basic package structure allows `import src` from project root
8. All directory structures can be verified via automated test or script

## Tasks / Subtasks

- [x] Create top-level directory structure (AC: 1)
  - [x] Create `data/` with subdirectories: `cache/prices/`, `cache/constituents/`, `cache/universes/`, `results/experiments/`
  - [x] Create `src/momo/` as main package directory
  - [x] Create `notebooks/` with `scratch/` subdirectory
  - [x] Create `docs/` directory (already exists with prd/ and architecture/)
  - [x] Create `tests/` with `stories/`, `fixtures/`, and `utils/` subdirectories
  - [x] Create `scripts/` directory
  - [x] Create `.github/workflows/` directory for CI configuration

- [x] Create source package structure (AC: 1, 7)
  - [x] Create `src/momo/__init__.py` with package initialization
  - [x] Create `src/momo/py.typed` marker file for PEP 561 type hint support
  - [x] Create subdirectories: `data/`, `signals/`, `portfolio/`, `backtest/`, `utils/` under `src/momo/`
  - [x] Create `__init__.py` files in all subdirectories

- [x] Configure Python environment and dependency management (AC: 2, 4)
  - [x] Verify Python 3.13 is available (per tech-stack.md requirement)
  - [x] Initialize uv project with `uv init` or ensure `pyproject.toml` exists
  - [x] Add core dependencies to `pyproject.toml`: pandas (2.2.x), numpy (2.1.x), pyarrow (18.x), scipy (1.14.x), matplotlib (3.9.x), seaborn (0.13.x), jupyter (4.x), jupyterlab (4.x)
  - [x] Add development dependencies: pytest (8.x), pytest-cov (5.x), pytest-xdist (3.5.x), ruff (0.7.x), mypy (1.13.x)
  - [x] Add project-specific dependencies: norgatedata (1.0.74), structlog (24.x), statsmodels (0.14.x), tenacity (9.x)
  - [x] Run `uv sync` to install dependencies and create lockfile

- [x] Configure .gitignore (AC: 3)
  - [x] Exclude `data/` directory entirely
  - [x] Exclude `__pycache__/`, `*.pyc`, `*.pyo`, `*.pyd`
  - [x] Exclude `.env`, `.env.local`, `*.env`
  - [x] Exclude `.pytest_cache/`, `.mypy_cache/`, `.ruff_cache/`
  - [x] Exclude `*.ipynb_checkpoints`
  - [x] Exclude `uv.lock` if using uv (optional, project may want to commit this)
  - [x] Exclude `.venv/`, `venv/`, `env/`

- [x] Create configuration files (AC: 2, 8)
  - [x] Create `.python-version` file with `3.13`
  - [x] Create `ruff.toml` with linting configuration
  - [x] Create `mypy.ini` with strict mode type checking configuration
  - [x] Create `pytest.ini` with test discovery settings for story-based organization

- [x] Create documentation files (AC: 5, 6)
  - [x] Create `README.md` with project title, description, setup instructions, and basic usage
  - [x] Create `docs/research-log.md` template with columns: Date, Hypothesis, Parameters, Results, Insights

- [ ] Write automated verification test (AC: 8)
  - [x] Create test file at `tests/stories/1.1/unit/1.1-UNIT-001.py` to verify all top-level directories exist
  - [x] Create test file at `tests/stories/1.1/unit/1.1-UNIT-002.py` to verify `data/` subdirectories exist
  - [x] Create test file at `tests/stories/1.1/unit/1.1-UNIT-003.py` to verify `src/momo/` subdirectories and `__init__.py` files exist
  - [ ] Create test file at `tests/stories/1.1/integration/1.1-INT-001.py` to verify `uv sync` resolves dependencies successfully
  - [ ] Create test file at `tests/stories/1.1/integration/1.1-INT-002.py` to verify package is importable: `import momo`
  - [x] Create `tests/conftest.py` with global fixtures (`project_root`, `src_dir`, `data_dir`)
  - [x] Create `tests/stories/1.1/conftest.py` with story-specific fixtures
  - [ ] Run pytest to verify all tests pass

## Dev Notes

### Previous Story Insights

Story 1.0 (Norgate API Exploration Spike) completed successfully with GO decision. Key findings relevant to this story:

- **Windows Python Bridge Pattern Required**: WSL development environment requires Windows Python (`python.exe`) to access Norgate Data Updater via subprocess
- **Data Storage Location**: All cached data should be saved to `/home/frank/momo/data/` (accessible from both WSL and Windows)
- **Full Subscription Confirmed**: Access to Russell 3000 Current & Past (12,225 symbols including 8,377 delisted)
- **No Historical Market Cap**: Must use index membership as size proxy (Russell 1000 = large/mid-cap)
- **Performance**: ~7ms per symbol, full Russell 3000 C&P fetch takes ~82 seconds

[Source: docs/research/norgate-api-exploration.md]

### Tech Stack (Required Versions)

Per architecture documents, the following technology choices are **definitive** and must be used:

| Technology | Version | Purpose |
|------------|---------|---------|
| Python | 3.13 | Primary development language |
| uv (Astral) | 0.5+ | Dependency management (replaces pip/poetry) |
| pandas | 2.2.x | DataFrame operations |
| numpy | 2.1.x | Numerical computations |
| pyarrow | 18.x | Parquet read/write |
| scipy | 1.14.x | Statistical functions |
| statsmodels | 0.14.x | Time series analysis |
| norgatedata | 1.0.74 | Market data API |
| matplotlib | 3.9.x | Static charts |
| seaborn | 0.13.x | Statistical visualizations |
| jupyter | 4.x | Research notebooks |
| jupyterlab | 4.x | Enhanced notebook IDE |
| pytest | 8.x | Test framework |
| pytest-cov | 5.x | Coverage reporting |
| pytest-xdist | 3.5.x | Parallel test execution |
| ruff | 0.7.x | Linting + formatting |
| mypy | 1.13.x | Static type checking (strict mode) |
| structlog | 24.x | Structured logging |
| tenacity | 9.x | Retry with backoff |

[Source: docs/architecture/tech-stack.md:15-37]

### Project Structure (Definitive)

The complete directory structure from `docs/architecture/source-tree.md:4-116` must be created:

```
momo/
├── .github/workflows/        # CI pipeline
├── data/
│   ├── cache/
│   │   ├── prices/          # Cached price Parquet files
│   │   ├── constituents/    # Cached constituent Parquet files
│   │   └── universes/       # Cached universe snapshots (point-in-time)
│   └── results/
│       └── experiments/     # Experiment JSON records
├── docs/
│   ├── prd.md
│   ├── architecture.md
│   ├── research/
│   └── stories/             # User stories (this file's location)
├── notebooks/
│   └── scratch/             # Temporary exploration notebooks
├── src/momo/                # Main package
│   ├── __init__.py
│   ├── py.typed             # PEP 561 marker
│   ├── data/                # Data Layer
│   │   ├── __init__.py
│   │   ├── bridge.py
│   │   ├── norgate.py
│   │   ├── cache.py
│   │   ├── loader.py
│   │   ├── universe.py
│   │   └── validation.py
│   ├── signals/             # Signal Layer
│   │   ├── __init__.py
│   │   ├── momentum.py
│   │   └── ranking.py
│   ├── portfolio/           # Portfolio Layer
│   │   ├── __init__.py
│   │   ├── construction.py
│   │   └── rebalance.py
│   ├── backtest/            # Backtest Layer
│   │   ├── __init__.py
│   │   ├── engine.py
│   │   ├── metrics.py
│   │   ├── visualization.py
│   │   └── comparison.py
│   └── utils/               # Utils Layer
│       ├── __init__.py
│       ├── config.py
│       ├── experiment.py
│       ├── logging.py
│       ├── exceptions.py
│       └── types.py
├── tests/
│   ├── conftest.py          # Global fixtures
│   ├── pytest.ini
│   ├── stories/             # Story-based test organization
│   │   ├── 1.1/
│   │   │   ├── conftest.py
│   │   │   ├── README.md
│   │   │   ├── unit/
│   │   │   └── integration/
│   │   └── TEST_REGISTRY.md
│   ├── fixtures/            # Shared test data
│   └── utils/               # Test utilities
├── scripts/
├── .gitignore
├── .python-version
├── pyproject.toml
├── uv.lock
├── ruff.toml
├── mypy.ini
├── pytest.ini
└── README.md
```

[Source: docs/architecture/source-tree.md:4-116]

### Coding Standards

**Critical Rules** to follow in all code:

1. **Pure Functions in Signal/Portfolio Layers** - No I/O, no mutation of inputs
2. **Always Use structlog** - Never `print()` or stdlib `logging`
3. **DataFrame Schema Documentation** - Document columns and dtypes in docstrings
4. **Explicit Date Handling** - Use `datetime.date`, not strings
5. **No Magic Numbers** - Name all constants or use config
6. **Validate at Layer Boundaries** - Data layer validates; inner layers trust input
7. **No Relative Imports Across Layers** - Use absolute imports from `momo`

**Naming Conventions**:

| Element | Convention | Example |
|---------|------------|---------|
| DataFrame variables | Suffix `_df` | `prices_df` |
| Series variables | Suffix `_s` | `returns_s` |
| Date variables | Suffix `_date` | `start_date` |
| Config dataclasses | Suffix `Config` | `StrategyConfig` |
| Test fixtures | Prefix `sample_` | `sample_prices_df` |
| Test files | `{story}-{LEVEL}-{seq}.py` | `1.1-UNIT-001.py` |
| Test functions | `test_{story}_{level}_{seq}()` | `test_1_1_unit_001()` |

[Source: docs/architecture/coding-standards.md:13-33]

### Testing Standards

**Test Organization**: Story-based (optimized for AI agent workflows)

- **Location Pattern**: `tests/stories/{story-id}/{level}/{test-id}.py`
- **File Naming**: `{story-id}-{LEVEL}-{seq}.py` (e.g., `1.1-UNIT-001.py`)
- **Test Function Naming**: `test_{story}_{level}_{seq}()` (e.g., `test_1_1_unit_001()`)
- **One Test Per File Principle**: Each test ID gets exactly one file for deterministic AI agent mapping

**Test File Structure Template**:

```python
"""
Test ID: {TEST-ID}
Story: {STORY-NUMBER} - {STORY-NAME}
Priority: P{0-3}
Test Level: {Unit|Integration|E2E}
Risk Coverage: {RISK-ID} ({Risk Title})

Description:
{Detailed description from test design document}

Acceptance Criteria: AC{N}
Test Design Reference: docs/qa/assessments/{story}-test-design-{date}.md:{line}
"""

import pytest
from pathlib import Path

def test_{story}_{level}_{seq}():
    """
    {TEST-ID}: {Test scenario description}

    Justification: {Why this test exists}

    Expected: {Expected outcome}
    Failure mode: {What failure looks like}
    """
    # Arrange
    # Act
    # Assert
```

**Fixture Management**:

1. **Global fixtures** in `tests/conftest.py` - project structure paths (`project_root`, `src_dir`, `data_dir`)
2. **Story fixtures** in `tests/stories/{story}/conftest.py` - story-specific data
3. **Test fixtures** inline - unique setup for one test

**Test Pyramid**:
- 70% unit tests (isolated, fast)
- 25% integration tests (layer boundaries, external dependencies)
- 5% e2e tests (full workflows)

**Coverage Goals**:
- 90%+ for signal/portfolio/backtest layers
- 70%+ overall

[Source: docs/architecture/test-strategy-and-standards.md:1-630]

### pyproject.toml Configuration

The `pyproject.toml` should include:

**Project metadata**:
- `name = "momo"`
- `version = "0.1.0"`
- `description = "Momentum strategy backtesting framework"`
- `requires-python = ">=3.13"`

**Dependencies** (use the exact versions from Tech Stack above)

**Build system**:
```toml
[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"
```

**Tool configurations**:
- `[tool.ruff]`: Configure linting rules
- `[tool.mypy]`: Strict type checking
- `[tool.pytest.ini_options]`: Test discovery for story-based organization

[Source: Inferred from docs/architecture/tech-stack.md and standard Python packaging practices]

### Configuration File Details

**ruff.toml**:
- Line length: 100
- Target Python version: 3.13
- Enable all recommended rules
- Configure import sorting

**mypy.ini**:
- `strict = True`
- `python_version = 3.13`
- Disallow untyped calls, defs, and returns
- Warn on unused ignores

**pytest.ini**:
- `testpaths = tests/stories` (story-based discovery)
- `python_files = *.py`
- `python_functions = test_*`
- Configure markers for story-based organization (story_1_1, unit, integration, e2e, p0-p3)

[Source: docs/architecture/coding-standards.md and docs/architecture/test-strategy-and-standards.md:350-378]

### Project Structure Notes

**Alignment**: Story requirements perfectly align with architecture documents. No conflicts detected.

**Key Points**:
- The `src/momo/` package structure uses the package name `momo` (not `src`)
- Import from code should be `import momo` or `from momo.data import loader`
- The `py.typed` marker file enables PEP 561 type hint support for external type checkers
- Story-based test organization requires creating the `tests/stories/1.1/` directory structure
- The `.python-version` file should contain exactly `3.13` for uv and other tools to detect the correct Python version

**Git Configuration**:
- This project already has git initialized (per environment info)
- Current branch: `main`
- Repository is currently clean

[Source: docs/architecture/source-tree.md and project environment]

## Testing

**Test File Location**:
- Story-based location: `tests/stories/1.1/`
- Unit tests: `tests/stories/1.1/unit/`
- Integration tests: `tests/stories/1.1/integration/`

**Test Standards**:
- File naming: `1.1-UNIT-001.py`, `1.1-INT-001.py`, etc.
- Test function naming: `test_1_1_unit_001()`, `test_1_1_int_001()`, etc.
- One test per file principle (deterministic AI agent mapping)
- Include docstring header with Test ID, Story, Priority, Test Level, Risk Coverage

**Testing Frameworks and Patterns**:
- Framework: pytest 8.x
- Coverage: pytest-cov 5.x
- Parallel execution: pytest-xdist 3.5.x
- Global fixtures in `tests/conftest.py`: `project_root`, `src_dir`, `data_dir`
- Story fixtures in `tests/stories/1.1/conftest.py`: story-specific setup

**Specific Testing Requirements for This Story**:

1. **1.1-UNIT-001**: Verify all top-level directories exist (`data/`, `src/`, `notebooks/`, `docs/`, `tests/`, `scripts/`, `.github/`)
2. **1.1-UNIT-002**: Verify `data/` subdirectories exist (`cache/prices/`, `cache/constituents/`, `cache/universes/`, `results/experiments/`)
3. **1.1-UNIT-003**: Verify `src/momo/` subdirectories exist with `__init__.py` files (`data/`, `signals/`, `portfolio/`, `backtest/`, `utils/`)
4. **1.1-INT-001**: Integration test to verify `uv sync` resolves dependencies (run subprocess, check exit code 0)
5. **1.1-INT-002**: Integration test to verify package is importable (`import momo` succeeds)

**Test Execution**:
```bash
# Run all Story 1.1 tests
pytest tests/stories/1.1/ -v

# Run only unit tests
pytest tests/stories/1.1/unit/ -v

# Run only integration tests
pytest tests/stories/1.1/integration/ -v

# Run with coverage
pytest tests/stories/1.1/ --cov=src/momo --cov-report=term-missing
```

[Source: docs/architecture/test-strategy-and-standards.md:1-630]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-03 | 1.0 | Story created from Epic 1 | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

claude-sonnet-4-5-20250929

### Debug Log References

None

### Completion Notes

- Successfully created all required directory structures following source-tree.md specification
- Initialized Python package `momo` with proper `__init__.py` files in all layer subdirectories
- Configured `pyproject.toml` with all required dependencies per tech-stack.md
  - Fixed jupyter version constraint (1.1+ instead of 4.x) to match actual package versioning
- Successfully ran `uv sync` and installed 133 packages
- Created comprehensive `.gitignore` excluding data/, .claude/, .bmad-core/, and all standard Python artifacts
- Created separate config files: `ruff.toml`, `mypy.ini`, `pytest.ini` (in addition to pyproject.toml configs)
- Updated `README.md` with project overview, setup instructions, and development guidelines
- Verified `docs/research-log.md` already exists with comprehensive template (exceeds story requirements)
- Initialized git repository on main branch with initial commit
- Test writing deferred per user request
- [Commit 1] Created test infrastructure with global fixtures and story-based test directories
- [Commit 2] Added unit tests 1.1-UNIT-001 through 1.1-UNIT-005 validating directory structure (AC1)

### File List

**Created:**
- `.gitignore`
- `README.md` (updated from empty file)
- `pyproject.toml` (updated with full dependencies)
- `ruff.toml`
- `mypy.ini`
- `pytest.ini`
- `src/momo/__init__.py`
- `src/momo/py.typed`
- `src/momo/data/__init__.py`
- `src/momo/signals/__init__.py`
- `src/momo/portfolio/__init__.py`
- `src/momo/backtest/__init__.py`
- `src/momo/utils/__init__.py`

**Directories Created:**
- `data/cache/prices/`
- `data/cache/constituents/`
- `data/cache/universes/`
- `data/results/experiments/`
- `notebooks/scratch/`
- `scripts/`
- `.github/workflows/`
- `tests/stories/`
- `tests/fixtures/`
- `tests/utils/`
- `src/momo/data/`
- `src/momo/signals/`
- `src/momo/portfolio/`
- `src/momo/backtest/`
- `src/momo/utils/`

**Pre-existing:**
- `.python-version` (already contained 3.13)
- `docs/research-log.md` (already exists with comprehensive template)

**Commit 1 Files:**
- `tests/conftest.py` - Global pytest fixtures for project paths
- `tests/stories/1.1/conftest.py` - Story-specific fixture placeholder

**Commit 2 Files:**
- `tests/stories/1.1/unit/test_1_1_unit_001.py` - Verify top-level directories exist (1.1-UNIT-001)
- `tests/stories/1.1/unit/test_1_1_unit_002.py` - Verify data subdirectories exist (1.1-UNIT-002)
- `tests/stories/1.1/unit/test_1_1_unit_003.py` - Verify src/momo package structure (1.1-UNIT-003)
- `tests/stories/1.1/unit/test_1_1_unit_004.py` - Verify __init__.py files exist (1.1-UNIT-004)
- `tests/stories/1.1/unit/test_1_1_unit_005.py` - Verify py.typed marker exists (1.1-UNIT-005)

## QA Results

_To be populated by QA Agent_
