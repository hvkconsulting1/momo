# Atomic Commit Plan: Story 1.1

**Total Commits:** 6
**Test Coverage:** 17/17 tests (7 P0, 8 P1, 2 P2)
**AC Coverage:** 8/8 acceptance criteria

---

## Commit 1: test(infra): create test fixtures and conftest files

**Tests:** Foundation for all tests
**ACs:** 8 (automated verification infrastructure)
**Priority:** P0

**Setup:**
- Create `tests/conftest.py` with global fixtures:
  - `project_root` fixture (session scope)
  - `src_dir` fixture (session scope)
  - `data_dir` fixture (session scope)
- Create `tests/stories/1.1/` directory structure
- Create `tests/stories/1.1/conftest.py` for story-specific fixtures (if needed)
- Create `tests/stories/1.1/unit/` directory
- Create `tests/stories/1.1/integration/` directory

**Verification:**
- All test directories exist
- `tests/conftest.py` contains fixture definitions
- Fixtures are importable: `pytest --collect-only tests/`
- No errors in fixture collection

**TDD Note:** This commit creates the test infrastructure that all subsequent test commits depend on.

---

## Commit 2: test(structure): add unit tests for directory structure validation

**Tests:** 1.1-UNIT-001, 1.1-UNIT-002, 1.1-UNIT-003, 1.1-UNIT-004, 1.1-UNIT-005
**ACs:** 1 (repository structure)
**Priority:** P0

**Setup:**
- Create `tests/stories/1.1/unit/1.1-UNIT-001.py` - Verify top-level directories exist
- Create `tests/stories/1.1/unit/1.1-UNIT-002.py` - Verify data/ subdirectories exist
- Create `tests/stories/1.1/unit/1.1-UNIT-003.py` - Verify src/momo/ package structure exists
- Create `tests/stories/1.1/unit/1.1-UNIT-004.py` - Verify all __init__.py files exist
- Create `tests/stories/1.1/unit/1.1-UNIT-005.py` - Verify py.typed marker file exists

**Verification:**
- Run: `pytest tests/stories/1.1/unit/1.1-UNIT-001.py -v`
- Run: `pytest tests/stories/1.1/unit/1.1-UNIT-002.py -v`
- Run: `pytest tests/stories/1.1/unit/1.1-UNIT-003.py -v`
- Run: `pytest tests/stories/1.1/unit/1.1-UNIT-004.py -v`
- Run: `pytest tests/stories/1.1/unit/1.1-UNIT-005.py -v`
- All 5 tests should PASS (structure already exists per story completion notes)

**TDD Note:** These tests validate the existing project structure. Since the structure is already created, tests should pass immediately (GREEN phase).

---

## Commit 3: test(config): add unit tests for configuration file validation

**Tests:** 1.1-UNIT-006, 1.1-UNIT-007, 1.1-UNIT-008, 1.1-UNIT-009
**ACs:** 2 (Python environment), 3 (Git configuration)
**Priority:** P0

**Setup:**
- Create `tests/stories/1.1/unit/1.1-UNIT-006.py` - Verify .python-version file contains '3.13'
- Create `tests/stories/1.1/unit/1.1-UNIT-007.py` - Verify .gitignore excludes data/ directory (HIGH RISK: OPS-001)
- Create `tests/stories/1.1/unit/1.1-UNIT-008.py` - Verify .gitignore excludes Python artifacts
- Create `tests/stories/1.1/unit/1.1-UNIT-009.py` - Verify .gitignore excludes .env files (SEC-001)

**Verification:**
- Run: `pytest tests/stories/1.1/unit/1.1-UNIT-006.py -v`
- Run: `pytest tests/stories/1.1/unit/1.1-UNIT-007.py -v` ⚠️ **CRITICAL TEST**
- Run: `pytest tests/stories/1.1/unit/1.1-UNIT-008.py -v`
- Run: `pytest tests/stories/1.1/unit/1.1-UNIT-009.py -v`
- All 4 tests should PASS (configuration files already created)

**TDD Note:** Test 1.1-UNIT-007 addresses HIGH RISK OPS-001 (Git data directory exclusion). Critical for preventing accidental commits of large data files.

---

## Commit 4: test(env): add critical integration tests for Python environment

**Tests:** 1.1-INT-001, 1.1-INT-002, 1.1-INT-007
**ACs:** 2 (Python environment), 7 (package importability)
**Priority:** P0

**Setup:**
- Create `tests/stories/1.1/integration/1.1-INT-001.py` - Verify uv sync resolves dependencies
- Create `tests/stories/1.1/integration/1.1-INT-002.py` - Verify Python 3.13 is available and executable
- Create `tests/stories/1.1/integration/1.1-INT-007.py` - Verify 'import momo' succeeds from project root

**Verification:**
- Run: `pytest tests/stories/1.1/integration/1.1-INT-001.py -v` (may be slow, ~10-30 seconds)
- Run: `pytest tests/stories/1.1/integration/1.1-INT-002.py -v`
- Run: `pytest tests/stories/1.1/integration/1.1-INT-007.py -v`
- All 3 tests should PASS (environment already configured)

**TDD Note:** These tests validate the core development environment. 1.1-INT-001 addresses TECH-001 (Python 3.13 compatibility) and TECH-003 (uv maturity).

---

## Commit 5: test(deps): add integration tests for dependencies and imports

**Tests:** 1.1-INT-003, 1.1-INT-004, 1.1-INT-005, 1.1-INT-008
**ACs:** 3 (Git configuration), 4 (dependency management), 7 (package importability)
**Priority:** P1

**Setup:**
- Create `tests/stories/1.1/integration/1.1-INT-003.py` - Verify data/ files are not tracked by git (HIGH RISK: OPS-001)
- Create `tests/stories/1.1/integration/1.1-INT-004.py` - Verify pyproject.toml specifies all required dependencies
  - **Note:** Requires `tomli` package for TOML parsing - add to dev dependencies if not present
- Create `tests/stories/1.1/integration/1.1-INT-005.py` - Verify core dependencies are importable
- Create `tests/stories/1.1/integration/1.1-INT-008.py` - Verify subpackages are importable

**Verification:**
- Run: `pytest tests/stories/1.1/integration/1.1-INT-003.py -v` ⚠️ **CRITICAL TEST**
- Run: `pytest tests/stories/1.1/integration/1.1-INT-004.py -v`
- Run: `pytest tests/stories/1.1/integration/1.1-INT-005.py -v`
- Run: `pytest tests/stories/1.1/integration/1.1-INT-008.py -v`
- All 4 tests should PASS

**TDD Note:** Test 1.1-INT-003 provides functional verification of .gitignore configuration (complements 1.1-UNIT-007). Test 1.1-INT-004 may require adding `tomli` to dev dependencies first.

---

## Commit 6: test(docs): add documentation validation tests

**Tests:** 1.1-UNIT-010, 1.1-UNIT-011, 1.1-INT-006
**ACs:** 5 (README documentation), 6 (research log template)
**Priority:** P2

**Setup:**
- Create `tests/stories/1.1/unit/1.1-UNIT-010.py` - Verify README.md exists in project root
- Create `tests/stories/1.1/unit/1.1-UNIT-011.py` - Verify docs/research-log.md exists
- Create `tests/stories/1.1/integration/1.1-INT-006.py` - Verify README contains required sections

**Verification:**
- Run: `pytest tests/stories/1.1/unit/1.1-UNIT-010.py -v`
- Run: `pytest tests/stories/1.1/unit/1.1-UNIT-011.py -v`
- Run: `pytest tests/stories/1.1/integration/1.1-INT-006.py -v`
- All 3 tests should PASS (documentation files already created)

**TDD Note:** These are lower-priority tests (P2) validating developer documentation. Safe to implement last.

---

## Execution Order Summary

1. **Test Infrastructure** (Commit 1): Create fixtures and test directories
2. **Structure Validation** (Commit 2): Verify project directories and package structure (5 tests, P0)
3. **Configuration Validation** (Commit 3): Verify config files and .gitignore (4 tests, P0)
4. **Environment Validation** (Commit 4): Verify Python, uv, and imports (3 tests, P0)
5. **Dependency Validation** (Commit 5): Verify dependencies and git behavior (4 tests, P1)
6. **Documentation Validation** (Commit 6): Verify README and research log (3 tests, P2)

## TDD Workflow for Each Commit

For each commit, follow this TDD cycle:

1. **RED**: Write the test file(s) according to the specifications in `docs/qa/assessments/1.1-test-design-20251203.md`
   - Copy the exact test code from the test design document
   - Ensure proper docstrings with Test ID, Story, Priority, Risk Coverage
2. **GREEN**: Tests should pass immediately (implementation already complete per story status)
   - If tests fail, implementation was incomplete - fix before committing
3. **VERIFY**: Run the specific tests to confirm they pass
   - Use `pytest tests/stories/1.1/unit/1.1-UNIT-XXX.py -v` for unit tests
   - Use `pytest tests/stories/1.1/integration/1.1-INT-XXX.py -v` for integration tests
4. **COMMIT**: Stage tests with the commit message
   - Stage test files only (implementation already committed)
   - Use conventional commit format

## Dependencies Between Commits

- **Commit 1** is required for all subsequent commits (provides fixtures)
- **Commits 2-6** can run independently after Commit 1
- **Commit 5** may require adding `tomli` to dev dependencies (check pyproject.toml first)
- **Priority order**: P0 tests (Commits 2-4) before P1 tests (Commit 5) before P2 tests (Commit 6)

## Risk Mitigation

**High-Risk Tests (Must Pass):**
- **1.1-UNIT-007** (Commit 3): .gitignore excludes data/ - Prevents accidental commit of gigabytes of data
- **1.1-INT-003** (Commit 5): Functional verification of git exclusion - Validates .gitignore actually works

**Medium-Risk Tests:**
- **1.1-INT-001** (Commit 4): uv sync validation - Ensures dependency resolution works
- **1.1-INT-002** (Commit 4): Python 3.13 availability - Validates correct Python version
- **1.1-INT-005** (Commit 5): Core dependencies importable - Validates Python 3.13 compatibility

## Final Verification

After all commits, run the complete test suite:

```bash
# Run all Story 1.1 tests
pytest tests/stories/1.1/ -v

# Run by priority
pytest tests/stories/1.1/ -v -m "p0"
pytest tests/stories/1.1/ -v -m "p1"

# Run with coverage
pytest tests/stories/1.1/ --cov=src/momo --cov-report=term-missing

# Expected results
# - 17 tests total
# - All tests PASS
# - Coverage: N/A (no implementation code in src/momo yet, just __init__.py)
```

## Notes

- **Atomic**: Each commit adds a cohesive group of tests validating related functionality
- **Traceable**: Test IDs and AC numbers provide clear traceability to requirements
- **TDD-Driven**: Tests validate existing implementation (already completed per story)
- **Reviewable**: Small, focused commits are easier to review
- **Risk-Prioritized**: P0 tests (critical) before P1 (high) before P2 (medium)

## Quality Gate Integration

After completing all commits, the quality gate file `docs/qa/gates/1.1-initialize-project-structure.yml` should be updated with:
- Test execution results (all 17 tests passing)
- Coverage metrics
- Risk mitigation status (OPS-001, TECH-001 fully covered)

---

**Generated:** 2025-12-03
**Story:** 1.1 - Initialize Project Structure and Development Environment
**Test Design Reference:** docs/qa/assessments/1.1-test-design-20251203.md
**Story Reference:** docs/stories/1.1.story.md
